# =============================================================================
# General
# =============================================================================

# キーストロークのディレイを減らす
set -s escape-time 0

# ターミナル設定 (True Color + italics 対応)
set -g default-terminal "tmux-256color"
set -sa terminal-overrides ",*:Tc"

# Vim/Neovim の FocusGained/FocusLost を有効にする
set -g focus-events on

# OSクリップボード連携 (macOS / WSL 等)
set -g set-clipboard on

# スクロールバック行数
set -g history-limit 50000

# ウィンドウ・ペイン番号を 1 始まりに (0 は遠い)
set -g base-index 1
setw -g pane-base-index 1

# ウィンドウを閉じたら番号を詰める
set -g renumber-windows on

# ウィンドウ名の自動リネームを無効化
setw -g automatic-rename off

# vi キーバインド (コピーモード)
setw -g mode-keys vi

# マウス操作を有効化
setw -g mouse on

# =============================================================================
# Prefix
# =============================================================================

unbind C-b
set -g prefix ^T
bind t send-prefix

# =============================================================================
# Key Bindings - Window
# =============================================================================

# 新規ウィンドウ
unbind ^C
bind ^C new-window -n zsh
bind c  new-window -n zsh

# 直前のウィンドウ
bind C-t last-window
bind ^A  last-window

# 次のウィンドウ
unbind ^N
bind ^N next-window
unbind " "
bind " " next-window
bind n   next-window

# 前のウィンドウ
unbind BSpace
bind BSpace previous-window

# ウィンドウ一覧
unbind ^W
bind ^W list-windows
bind w   list-windows

# ウィンドウ選択 (インタラクティブ)
unbind '"'
bind '"' choose-window

# ウィンドウ名変更
unbind A
bind A command-prompt "rename-window %%"

# =============================================================================
# Key Bindings - Pane
# =============================================================================

# ペイン分割 (vim 風: v=横, H=縦)
bind v split-window -h -c "#{pane_current_path}"
bind H split-window -v -c "#{pane_current_path}"
bind | split-window -h -c "#{pane_current_path}"

# ペイン移動 (vim 風)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# ペインリサイズ (vim 風, リピート可)
bind -r C-h resize-pane -L 5
bind -r C-j resize-pane -D 5
bind -r C-k resize-pane -U 5
bind -r C-l resize-pane -R 5

# ペインを独立ウィンドウに
bind b break-pane

# ペイン番号表示
bind i display-panes

# ペイン/ウィンドウ終了 (確認付き)
bind K   confirm-before -p "kill-window #W? (y/n)" kill-window
bind C-k confirm-before -p "kill-pane #P? (y/n)" kill-pane

# =============================================================================
# Key Bindings - Copy Mode
# =============================================================================

bind -r ^"[" copy-mode
bind -r ^]   paste-buffer

# =============================================================================
# Key Bindings - Session / Misc
# =============================================================================

# デタッチ
bind ^D detach

# クライアント一覧
bind * list-clients

# サーバー終了 (確認付き)
bind '\' confirm-before "kill-server"

# 画面リフレッシュ
bind ^R refresh-client

# 設定ファイル再読み込み
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# =============================================================================
# Status Line
# =============================================================================

set -g status-interval 5
set -g status-left-length 32
set -g status-right-length 150

# 全体
set -g status-style fg=white,bg=colour234,dim

# 左部: hostname > session > whoami
set -g status-left '\
#[fg=colour223,bg=colour202,bold] #(hostname -s) \
#[fg=colour202,bg=colour238,nobold]*\
#[fg=colour245,bg=colour238,bold] #(whoami) \
#[fg=colour238,bg=colour234,nobold]* #S '

# ウィンドウ (非アクティブ)
setw -g window-status-format "#[fg=white,bg=colour234] #I #W "

# ウィンドウ (アクティブ)
setw -g window-status-current-format "\
#[fg=colour234,bg=colour39]*\
#[fg=colour25,bg=colour39,noreverse,bold] #I * #W \
#[fg=colour39,bg=colour234,bold]*"

# 右部: host / pane / 日時
set -g status-right '\
#[fg=colour241]#H * #I:#P \
#[fg=colour31,bg=colour234,nobold]*\
#[fg=colour31,bg=colour255,bold] %Y/%m/%d(%a) %H:%M #[default]'

# =============================================================================
# Colors
# =============================================================================

# ペイン境界線
set -g pane-border-style fg=colour245
set -g pane-active-border-style fg=colour39

# コピーモード
setw -g mode-style bg=white,fg=black

# ウィンドウステータス
setw -g window-status-style bg=black,fg=white
setw -g window-status-current-style bg=blue,fg=black,bold,underscore

# メッセージ
set -g message-style bold,fg=white,bg=red
